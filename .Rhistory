df <- d%>%
make_long(Relationship,
Gender,
Outcome)
s1 <- sample(x= c("Single",
"Married",
"Married with kids",
"Married Without kids"),
size = 100,
replace=TRUE)
s2 <- sample(x= c("Male",
"Female"),
size = 100,
replace=TRUE)
s3 <- sample(x= c("Happy",
"Not Happy"),
size = 100,
replace=TRUE)
d <- data.frame(cbind(s1,s2,s3))
names(d) <- c('Relationship',
'Gender',
'Outcome')
df <- d%>%
make_long(Relationship,
Gender,
Outcome)
library(ggsankey)
devtools::install_github("davidsjoberg/ggsankey")
s1 <- sample(x= c("Single",
"Married",
"Married with kids",
"Married Without kids"),
size = 100,
replace=TRUE)
s2 <- sample(x= c("Male",
"Female"),
size = 100,
replace=TRUE)
s3 <- sample(x= c("Happy",
"Not Happy"),
size = 100,
replace=TRUE)
d <- data.frame(cbind(s1,s2,s3))
names(d) <- c('Relationship',
'Gender',
'Outcome')
df <- d%>%
make_long(Relationship,
Gender,
Outcome)
library(ggplot2)
library(dplyr)
df <- d%>%
make_long(Relationship,
Gender,
Outcome)
library(ggsankey)
library(ggplot2)
library(dplyr)
set.seed(111)
# Simple
t1 <- sample(x = c("Hosp A", "Hosp B", "Hosp C","Hosp D") , size = 100, replace=TRUE)
t2 <- sample(x = c("Male", "Female")   , size = 100, replace=TRUE)
t3 <- sample(x = c("Survived", "Died") , size = 100, replace=TRUE)
d <- data.frame(cbind(t1,t2,t3))
names(d) <- c('Hospital', 'Gender',  'Outcome')
head(d)
df <- d %>%
make_long(Hospital, Gender, Outcome)
df
# Chart 1
pl <- ggplot(df, aes(x = x
, next_x = next_x
, node = node
, next_node = next_node
, fill = factor(node)
, label = node)
)
pl <- pl +geom_sankey(flow.alpha = 0.5
, node.color = "black"
,show.legend = FALSE)
pl <- pl +geom_sankey_label(size = 3, color = "black", fill= "white", hjust = -0.5)
pl <- pl +  theme_bw()
pl <- pl + theme(legend.position = "none")
pl <- pl +  theme(axis.title = element_blank()
, axis.text.y = element_blank()
, axis.ticks = element_blank()
, panel.grid = element_blank())
pl <- pl + scale_fill_viridis_d(option = "inferno")
pl <- pl + labs(title = "Sankey diagram using ggplot")
pl <- pl + labs(subtitle = "using  David Sjoberg's ggsankey package")
pl <- pl + labs(caption = "@techanswers88")
pl <- pl + labs(fill = 'Nodes')
pl
rm (list = ls())
library(ggsankey)
library(ggplot2)
library(dplyr)
#Create data which can be used for Sankey
set.seed(111)
t1 <- sample(x = c("Hosp A", "Hosp B", "Hosp C","Hosp D") , size = 100, replace=TRUE)
t2 <- sample(x = c("Male", "Female")   , size = 100, replace=TRUE)
t3 <- sample(x = c("Survived", "Died") , size = 100, replace=TRUE)
d <- data.frame(cbind(t1,t2,t3))
names(d) <- c('Hospital', 'Gender',  'Outcome')
head(d)
df <- d %>%
make_long(Hospital, Gender, Outcome)
df
View(df)
View(d)
d_ind$first_treat
################################
# Dynamic DID
################################
rm (list = ls())
library(foreign)
library(did)
library(Hmisc)
library(gridExtra)
library("ggplot2")
set.seed(987654)
###############################
# Load and prepare clean data
###############################
# load
load("~/Dropbox/Nationalism Chile/01_data/clean_data/individual_county_immigration_2023apr26.RData")
table(d_ind$year)
names(d_ind)
# covariates
table(d_ind$age, exclude = NULL)
table(d_ind$education, exclude = NULL)
table(d_ind$female, exclude = NULL)
# treatment
table(d_ind$first_treat, exclude = NULL)
# outcome
d_ind$nationalism = (d_ind$proud_chilean + d_ind$identify_chile)/2
d_ind$nationalism_s = (d_ind$nationalism - mean(d_ind$nationalism, na.rm = T))/sd(d_ind$nationalism, na.rm = T)
describe(d_ind$nationalism_s)
d_ind$first_treat
round(mean(d_ind$nationalism[d_ind$first_treat==2017], na.rm = T),2)
round(mean(d_ind$nationalism[d_ind$first_treat==0], na.rm = T),2)
d_ind$ola
round(mean(d_ind$nationalism[d_ind$first_treat==2017 & d_ind$ola==2017], na.rm = T),2)
round(mean(d_ind$nationalism[d_ind$first_treat==2017 & d_ind$ola==2017|d_ind$first_treat==2018 & d_ind$ola==2018], na.rm = T),2)
round(mean(d_ind$nationalism[d_ind$first_treat==2017 & d_ind$ola==2018, na.rm = T),2)
d_ind$nationalism[d_ind$first_treat==2017 & d_ind$ola==2018]
round(mean(d_ind$nationalism[d_ind$first_treat==2017 & d_ind$ola==2018], na.rm = T),2)
################################
# Descriptive statistics
################################
rm (list = ls())
#sink("~/Dropbox/Climate change and disasters/02_analyses/11_DID_cluster.txt")
library(foreign)
library(lmtest)
library(sandwich)
library(stargazer)
library(msm)
library(Hmisc)
library(ggplot2)
library(lfe)
library(data.table)
library(tidyverse)
library(readstata13)
library(gridExtra)
library(ggpubr)
library(grid)
###############################
# Load and prepare clean data
###############################
# load
load("~/Dropbox/Nationalism Chile/01_data/clean_data/individual_county_immigration_2023apr26.RData")
names(d_ind)
names(d_county)
# check treatment
table(d_ind_ind$first_treat)
################################
# Descriptive statistics
################################
rm (list = ls())
#sink("~/Dropbox/Climate change and disasters/02_analyses/11_DID_cluster.txt")
library(foreign)
library(lmtest)
library(sandwich)
library(stargazer)
library(msm)
library(Hmisc)
library(ggplot2)
library(lfe)
library(data.table)
library(tidyverse)
library(readstata13)
library(gridExtra)
library(ggpubr)
library(grid)
###############################
# Load and prepare clean data
###############################
# load
load("~/Dropbox/Nationalism Chile/01_data/clean_data/individual_county_immigration_2023apr26.RData")
names(d_ind)
names(d_county)
# check treatment
table(d_ind_ind$first_treat)
table(d_ind_ind$first_treat)
################################
# Descriptive statistics
################################
rm (list = ls())
#sink("~/Dropbox/Climate change and disasters/02_analyses/11_DID_cluster.txt")
library(foreign)
library(lmtest)
library(sandwich)
library(stargazer)
library(msm)
library(Hmisc)
library(ggplot2)
library(lfe)
library(data.table)
library(tidyverse)
library(readstata13)
library(gridExtra)
library(ggpubr)
library(grid)
###############################
# Load and prepare clean data
###############################
# load
load("~/Dropbox/Nationalism Chile/01_data/clean_data/individual_county_immigration_2023apr26.RData")
names(d_ind)
names(d_county)
# check treatment
table(d_ind$first_treat)
table(d_ind$t_stagg)
table(d_ind$first_treat,d_ind_ind$t_stagg)
################################
# Descriptive statistics
################################
rm (list = ls())
#sink("~/Dropbox/Climate change and disasters/02_analyses/11_DID_cluster.txt")
library(foreign)
library(lmtest)
library(sandwich)
library(stargazer)
library(msm)
library(Hmisc)
library(ggplot2)
library(lfe)
library(data.table)
library(tidyverse)
library(readstata13)
library(gridExtra)
library(ggpubr)
library(grid)
###############################
# Load and prepare clean data
###############################
# load
load("~/Dropbox/Nationalism Chile/01_data/clean_data/individual_county_immigration_2023apr26.RData")
names(d_ind)
names(d_county)
# check treatment
table(d_ind$first_treat)
table(d_ind$t_stagg)
table(d_ind$first_treat,d_ind$t_stagg)
#####################
# Descriptive figure
#####################
d_ind$nationalism = (d_ind$proud_chilean+d_ind$identify_chile)/2
table(d_ind$first_treat)
outcome_control_2016 = mean(d_ind$nationalism[d_ind$year==2016 & d_ind$first_treat == 0], na.rm = T)
outcome_control_2017 = mean(d_ind$nationalism[d_ind$year==2017 & d_ind$first_treat == 0], na.rm = T)
outcome_control_2018 = mean(d_ind$nationalism[d_ind$year==2018 & d_ind$first_treat == 0], na.rm = T)
outcome_control_2016
outcome_control_2017
outcome_control_2018
# exposed 2017
outcome_treated2017_2016 = mean(d_ind$nationalism[d_ind$year==2016 & d_ind$first_treat == 2017], na.rm = T)
outcome_treated2017_2017 = mean(d_ind$nationalism[d_ind$year==2017 & d_ind$first_treat == 2017], na.rm = T)
outcome_treated2017_2018 = mean(d_ind$nationalism[d_ind$year==2018 & d_ind$first_treat == 2017], na.rm = T)
outcome_treated2017_2016
outcome_treated2017_2017
outcome_treated2017_2018
# expose 2018
outcome_treated2018_2016 = mean(d_ind$nationalism[d_ind$year==2016 & d_ind$first_treat == 2018], na.rm = T)
outcome_treated2018_2017 = mean(d_ind$nationalism[d_ind$year==2017 & d_ind$first_treat == 2018], na.rm = T)
outcome_treated2018_2018 = mean(d_ind$nationalism[d_ind$year==2018 & d_ind$first_treat == 2018], na.rm = T)
outcome_treated2018_2016
outcome_treated2018_2017
outcome_treated2018_2018
# plot
outcome = c(outcome_control_2016,outcome_control_2017,outcome_control_2018,
outcome_treated2017_2016,outcome_treated2017_2017,outcome_treated2017_2018,
outcome_treated2018_2016,outcome_treated2018_2017,outcome_treated2018_2018)
shock = c(2015,2016,2017)
group = c("never treated","never treated","never treated",
"first treated in 2016","first treated in 2016","first treated in 2016",
"first treated in 2017","first treated in 2017","first treated in 2017")
f = data.frame(shock, group, outcome)
library(ggplot2)
p = ggplot(f) + geom_line(aes(x = shock, y = outcome, group = group, colour = group)) +
labs(y= "Negative sentiment score", x = "Year") + scale_x_continuous(breaks=c(2015,2016,2017)) + scale_y_continuous(breaks=c(0,1)) + theme_bw()
p
nationalism_never = d_ind$nationalism[d_ind$first_treat==0]
d_ind$nationalism
d_ind$nationalism[d_ind$first_treat==0]
nationalism_never = d_ind$nationalism[d_ind$first_treat==0]
nationalism_never = d_ind$nationalism[d_ind$first_treat==0]
nationalism_second = d_ind$nationalism[d_ind$first_treat==2017 & d_ind$ola==2018]
nationalism_second
nationalism_first  = d_ind$nationalism[d_ind$first_treat==2017 & d_ind$ola==2017|d_ind$first_treat==2018 & d_ind$ola==2018]
nationalism_first
library(stargazer)
stargazer(nationalism_never)
mean(nationalism_never,na.rm=T)
length(nationalism_never)
length(nationalism_second)
################################
# Descriptive statistics
################################
rm (list = ls())
#sink("~/Dropbox/Climate change and disasters/02_analyses/11_DID_cluster.txt")
library(foreign)
library(lmtest)
library(sandwich)
library(stargazer)
library(msm)
library(Hmisc)
library(ggplot2)
library(lfe)
library(data.table)
library(tidyverse)
library(readstata13)
library(gridExtra)
library(ggpubr)
library(grid)
###############################
# Load and prepare clean data
###############################
# load
load("~/Dropbox/Nationalism Chile/01_data/clean_data/individual_county_immigration_2023apr26.RData")
names(d_ind)
names(d_county)
# check treatment
table(d_ind$first_treat)
table(d_ind$t_stagg)
table(d_ind$first_treat,d_ind$t_stagg)
#####################
# Descriptive table
#####################
# outcome nationalism
d_ind$nationalism = (d_ind$proud_chilean + d_ind$identify_chile)/2
d_ind$nationalism_s = (d_ind$nationalism - mean(d_ind$nationalism, na.rm = T))/sd(d_ind$nationalism, na.rm = T)
describe(d_ind$nationalism_s)
# descriptive outcomes
nationalism_never = d_ind$nationalism[d_ind$first_treat==0]
nationalism_first  = d_ind$nationalism[d_ind$first_treat==2017 & d_ind$ola==2017|d_ind$first_treat==2018 & d_ind$ola==2018]
nationalism_second = d_ind$nationalism[d_ind$first_treat==2017 & d_ind$ola==2018]
n1 = length(nationalism_never)
n2 = length(nationalism_first)
n3 = length(nationalism_second)
mean1 = mean(nationalism_never,na.rm=T)
mean2 = mean(nationalism_first,na.rm=T)
mean3 = mean(nationalism_second,na.rm=T)
sd1 = sd(nationalism_never,na.rm=T)
sd2 = sd(nationalism_first,na.rm=T)
sd3 = sd(nationalism_second,na.rm=T)
min1 = min(nationalism_never)
min2 = min(nationalism_first)
min3 = min(nationalism_second)
max1 = min(nationalism_never)
max2 = min(nationalism_first)
max3 = min(nationalism_second)
group = c("Never Treated","First Treated","Second Treated")
mean = c(mean1,mean2,mean3)
sd = c(sd1,sd2,sd3)
min = c(min1,min2,min3)
max = c(max1,max2,max3)
table = data.frame(group,mean,sd,min,max)
table
min(nationalism_never)
################################
# Descriptive statistics
################################
rm (list = ls())
#sink("~/Dropbox/Climate change and disasters/02_analyses/11_DID_cluster.txt")
library(foreign)
library(lmtest)
library(sandwich)
library(stargazer)
library(msm)
library(Hmisc)
library(ggplot2)
library(lfe)
library(data.table)
library(tidyverse)
library(readstata13)
library(gridExtra)
library(ggpubr)
library(grid)
###############################
# Load and prepare clean data
###############################
# load
load("~/Dropbox/Nationalism Chile/01_data/clean_data/individual_county_immigration_2023apr26.RData")
names(d_ind)
names(d_county)
# check treatment
table(d_ind$first_treat)
table(d_ind$t_stagg)
table(d_ind$first_treat,d_ind$t_stagg)
#####################
# Descriptive table
#####################
# outcome nationalism
d_ind$nationalism = (d_ind$proud_chilean + d_ind$identify_chile)/2
d_ind$nationalism_s = (d_ind$nationalism - mean(d_ind$nationalism, na.rm = T))/sd(d_ind$nationalism, na.rm = T)
describe(d_ind$nationalism_s)
# descriptive outcomes
nationalism_never = d_ind$nationalism[d_ind$first_treat==0]
nationalism_first  = d_ind$nationalism[d_ind$first_treat==2017 & d_ind$ola==2017|d_ind$first_treat==2018 & d_ind$ola==2018]
nationalism_second = d_ind$nationalism[d_ind$first_treat==2017 & d_ind$ola==2018]
n1 = length(nationalism_never)
n2 = length(nationalism_first)
n3 = length(nationalism_second)
mean1 = mean(nationalism_never,na.rm=T)
mean2 = mean(nationalism_first,na.rm=T)
mean3 = mean(nationalism_second,na.rm=T)
sd1 = sd(nationalism_never,na.rm=T)
sd2 = sd(nationalism_first,na.rm=T)
sd3 = sd(nationalism_second,na.rm=T)
min1 = min(nationalism_never,na.rm=T)
min2 = min(nationalism_first,na.rm=T)
min3 = min(nationalism_second,na.rm=T)
max1 = min(nationalism_never,na.rm=T)
max2 = min(nationalism_first,na.rm=T)
max3 = min(nationalism_second,na.rm=T)
group = c("Never Treated","First Treated","Second Treated")
mean = c(mean1,mean2,mean3)
sd = c(sd1,sd2,sd3)
min = c(min1,min2,min3)
max = c(max1,max2,max3)
table = data.frame(group,mean,sd,min,max)
table
nationalism_never
min(nationalism_never,na.rm=T)
################################
# Descriptive statistics
################################
rm (list = ls())
#sink("~/Dropbox/Climate change and disasters/02_analyses/11_DID_cluster.txt")
library(foreign)
library(lmtest)
library(sandwich)
library(stargazer)
library(msm)
library(Hmisc)
library(ggplot2)
library(lfe)
library(data.table)
library(tidyverse)
library(readstata13)
library(gridExtra)
library(ggpubr)
library(grid)
###############################
# Load and prepare clean data
###############################
# load
load("~/Dropbox/Nationalism Chile/01_data/clean_data/individual_county_immigration_2023apr26.RData")
names(d_ind)
names(d_county)
# check treatment
table(d_ind$first_treat)
table(d_ind$t_stagg)
table(d_ind$first_treat,d_ind$t_stagg)
#####################
# Descriptive table
#####################
# outcome nationalism
d_ind$nationalism = (d_ind$proud_chilean + d_ind$identify_chile)/2
d_ind$nationalism_s = (d_ind$nationalism - mean(d_ind$nationalism, na.rm = T))/sd(d_ind$nationalism, na.rm = T)
describe(d_ind$nationalism_s)
# descriptive outcomes
nationalism_never = d_ind$nationalism[d_ind$first_treat==0]
nationalism_first  = d_ind$nationalism[d_ind$first_treat==2017 & d_ind$ola==2017|d_ind$first_treat==2018 & d_ind$ola==2018]
nationalism_second = d_ind$nationalism[d_ind$first_treat==2017 & d_ind$ola==2018]
n1 = length(nationalism_never)
n2 = length(nationalism_first)
n3 = length(nationalism_second)
mean1 = mean(nationalism_never,na.rm=T)
mean2 = mean(nationalism_first,na.rm=T)
mean3 = mean(nationalism_second,na.rm=T)
sd1 = sd(nationalism_never,na.rm=T)
sd2 = sd(nationalism_first,na.rm=T)
sd3 = sd(nationalism_second,na.rm=T)
min1 = min(nationalism_never,na.rm=T)
min2 = min(nationalism_first,na.rm=T)
min3 = min(nationalism_second,na.rm=T)
max1 = max(nationalism_never,na.rm=T)
max2 = max(nationalism_first,na.rm=T)
max3 = max(nationalism_second,na.rm=T)
group = c("Never Treated","First Treated","Second Treated")
mean = c(mean1,mean2,mean3)
sd = c(sd1,sd2,sd3)
min = c(min1,min2,min3)
max = c(max1,max2,max3)
table = data.frame(group,mean,sd,min,max)
table
stargazer(table)
stargazer(table, summary=FALSE, rownames=FALSE)
stargazer(table, summary=FALSE, rownames=FALSE,digits = 2)
